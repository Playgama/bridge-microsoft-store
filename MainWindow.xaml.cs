using Microsoft.UI; using Microsoft.UI.Dispatching; using Microsoft.UI.Xaml; using Microsoft.UI.Windowing; using Microsoft.Web.WebView2.Core; using System; using System.IO; using System.Threading.Tasks; using Windows.Graphics; using WinRT.Interop;  namespace PlaygamaBridgeMicrosoftStore {     public sealed partial class MainWindow : Window     {         public MainWindow()         {             InitializeComponent();             SetInitialSize(1100, 720);             _ = InitializeAsync();         }          private async Task InitializeAsync()         {             await GameWebView.EnsureCoreWebView2Async();             GameWebView.CoreWebView2.WebMessageReceived += CoreWebView2_WebMessageReceived;              var htmlPath = Path.Combine(AppContext.BaseDirectory, "Assets", "game");              GameWebView.CoreWebView2.SetVirtualHostNameToFolderMapping(                 "app.local",
                htmlPath,
                CoreWebView2HostResourceAccessKind.Allow                );              GameWebView.Source = new Uri("https://app.local/index.html");         }          private void CoreWebView2_WebMessageReceived(CoreWebView2 sender, CoreWebView2WebMessageReceivedEventArgs args)         {             var msg = args.TryGetWebMessageAsString();             AppendLog($"Web → Host: {msg}");              // Пример ответа обратно в web             var reply = $"Host received: {msg}";             sender.PostWebMessageAsString(reply);             AppendLog($"Host → Web: {reply}");         }          private void SendButton_Click(object sender, RoutedEventArgs e)         {             var msg = MessageTextBox.Text ?? string.Empty;             if (GameWebView.CoreWebView2 is null)             {                 AppendLog("CoreWebView2 not initialized yet.");                 return;             }              GameWebView.CoreWebView2.PostWebMessageAsString(msg);             AppendLog($"Host → Web: {msg}");         }          private void AppendLog(string text)         {             DispatcherQueue.TryEnqueue(() =>             {                 LogListBox.Items.Insert(0, $"[{DateTime.Now:HH:mm:ss}] {text}");             });         }          private void SetInitialSize(int width, int height)         {             var hwnd = WindowNative.GetWindowHandle(this);             var windowId = Win32Interop.GetWindowIdFromWindow(hwnd);             var appWindow = AppWindow.GetFromWindowId(windowId);              appWindow.Resize(new SizeInt32(width, height));         }     } } 